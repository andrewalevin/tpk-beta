name: ðŸ’Ž tpk-runner
run-name: ðŸš€ tpk-runner (${{ github.actor }})ðŸš€
on:
  schedule:
    - cron: '*/10 * * * *'
  push:
    branches:
      - main
  release:
    types: [published]
    
permissions:
  contents: write
jobs:
  tpk-runner:
    runs-on: ubuntu-latest
    env:
      TPK_BOT_TOKEN: ${{ secrets.TPK_BOT_TOKEN }}
      TPK_ENCRYPT_AES_KEY_BASE64: ${{ secrets.TPK_ENCRYPT_AES_KEY_BASE64 }}
      TPK_CHANNELS_IDS_LIST: ${{ vars.TPK_CHANNELS_IDS_LIST }}
      TPK_CHANNELS_IDS_LIST_ENCRYPTED: ${{ vars.TPK_CHANNELS_IDS_LIST_ENCRYPTED }}
      TPK_ENCRYPT_AES_IV_BASE64: ${{ vars.TPK_ENCRYPT_AES_IV_BASE64 }}
      TPK_SKIP_DOWNLOAD_BIGGER: ${{ vars.TPK_SKIP_DOWNLOAD_BIGGER }}
      TPK_STORE_DIR: ${{ vars.TPK_STORE_DIR }}      
    steps:
      - name: ðŸ‘‹ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ Set up Python environment
        uses: actions/setup-python@v3
        with:
          python-version: '3.x'

      - name: ðŸ”„ Install TPK
        run: pip install telepostkeeper

      - name: ðŸ”„ Install process-time-killer
        run: pip install process-time-killer

      - name: ðŸ“¡ Listening
        run: timekiller "telepostkeeper" --timeout 30

      - name: ðŸ–¼ Frontend
        run: telepostkeeper-frontend
      
      - name: Get current date-time
        run: echo "COMMIT_MESSAGE=$(date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_ENV

      - name: ðŸ’¾ Git Auto Commit
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: ${{ env.COMMIT_MESSAGE }}
          
      


          





  
